<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .form-row {
            margin-bottom: 1rem;
        }

        /* Custom styles for the search dropdown */
        .search-container {
            position: relative;
        }

        .search-results {
            position: absolute;
            z-index: 1000;
            width: 100%;
            background-color: #fff;
            border: 1px solid #ced4da;
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            /* Initially hidden */
        }

        .search-results ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .search-results ul li {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f8f9fa;
        }

        .search-results ul li:hover {
            background-color: #e9ecef;
        }
    </style>
    <!-- <script th:src="@{/static/javaScript/myfile.js}" defer></script> -->

</head>

<body>
    <div th:fragment="purchaseEntryForm">
        <form id="purchaseForm" th:action="@{/purchase/save}" th:object="${purchaseEntry}" method="post">
            <!-- Purchase Entry Details -->
            <div class="form-row">
                <div class="col-md-6 mb-3">
                    <label for="billNumber">Bill Number</label>
                    <input type="text" class="form-control" id="billNumber" th:field="*{billNumber}" required />
                </div>
                <div class="col-md-6 mb-3">
                    <label for="dateOfPurchase">Date of Purchase</label>
                    <input type="date" class="form-control" id="dateOfPurchase" th:field="*{dateOfPurchase}" required />
                </div>
                <div class="col-md-6 mb-3">
                    <label for="supplierInfo">Supplier Info</label>
                    <input type="text" class="form-control" id="supplierInfo" th:field="*{supplierInfo}"
                        placeholder="Supplier Name" required />
                </div>
            </div>

            <!-- Total Amount -->
            <div class="form-group">
                <label for="totalAmount">Total Amount</label>
                <input type="number" class="form-control" id="purchaseTotalAmount" th:field="*{totalAmount}"
                    placeholder="Total Amount" step="0.01" min="0" required readonly />
            </div>

            <!-- Purchase Entry Items Table -->
            <div class="table-responsive">
                <table class="table table-striped table-bordered" id="purchaseItemTable">
                    <thead>
                        <tr>
                            <th>Barcode Number</th>
                            <th>Product Name</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- This block will be repeated for each item in the list -->
                        <tr th:each="item, stat : *{items}" th:id="'row-' + ${stat.index}">

                            <td>
                                <input type="text" class="form-control barcode-input focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    th:field="*{items[__${stat.index}__].barcode}"
                                    placeholder="Scan/type barcode number" id="barcodeSearchInput"
                                    name="barcodeSearchInput" autofocus required />
                            </td>
                            <td>
                                <!-- The search container for the dynamic dropdown -->
                                <div class="search-container">
                                    <input type="text" class="form-control product-search-input"
                                        th:field="*{items[__${stat.index}__].productInfo}"
                                        placeholder="" required autocomplete="off" readonly />
                                    <input type="hidden" class="product-id-input-hidden"
                                        th:field="*{items[__${stat.index}__].productId}" />
                                    <div class="search-results">
                                        <ul></ul>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <input type="number" class="form-control quantity-input"
                                    th:field="*{items[__${stat.index}__].quantity}" placeholder="Quantity" min="1"
                                    required />
                            </td>
                            <td>
                                <input type="number" class="form-control price-input"
                                    th:field="*{items[__${stat.index}__].price}" readonly placeholder="Price" step="0.01" min="0"
                                    required />
                            </td>
                            <td class="text-center">
                                <button type="button" class="btn btn-danger btn-sm remove-button"
                                    th:if="${stat.index > 0}"
                                    th:onclick="'removeRow(' + ${stat.index} + ');'">Remove</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="d-flex justify-content-between mt-3">
                <button type="button" class="btn btn-success add-button" id="purchaseAddRowButton"
                    onclick="addPurchesItemRow()">Add Item</button>
                <input type="submit" class="btn btn-primary" value="Save Purchase" />
            </div>
        </form>
        <template id="purchase-item-row-template">
            <tr>
                <td>
                    <input type="text" class="form-control barcode-input" name="items[INDEX_PLACEHOLDER_X].barcode"
                        placeholder="Scan/type barcode number" autofocus required />
                </td>
                <td>
                    <div class="search-container">
                        <input type="text" class="form-control product-search-input"
                            name="items[INDEX_PLACEHOLDER_X].productInfo" readonly
                            autocomplete="off" />
                        <input type="hidden" name="items[INDEX_PLACEHOLDER_X].productId"
                            class="product-id-input-hidden" />
                        <div class="search-results">
                            <ul></ul>
                        </div>
                    </div>
                </td>
                <td>
                    <input type="number" class="form-control quantity-input" name="items[INDEX_PLACEHOLDER_X].quantity"
                        placeholder="Quantity" min="1" required />
                </td>
                <td>
                    <input type="number" class="form-control price-input" name="items[INDEX_PLACEHOLDER_X].price"
                        placeholder="Price" readonly step="0.01" min="0" required />
                </td>
                <td class="text-center">
                    <button type="button" class="btn btn-danger btn-sm remove-button">Remove</button>
                </td>
            </tr>
        </template>
    </div>

    <script>

        
    </script>
</body>
